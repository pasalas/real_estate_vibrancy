INSERT INTO `meli-bi-data.SBOX_MKTVIS.DASH_REAL_ESTATE_VIBRANCY`

SELECT
    COALESCE(A.YEAR_MONTH,B.YEAR_MONTH) AS YEAR_MONTH
  , COALESCE(A.SITE_ID,B.SITE_ID) AS SITE_ID
  , COALESCE(A.USER_TYPE,B.USER_TYPE) AS USER_TYPE
  , COALESCE(A.CUSTOMER_SELLER_ID,B.CUSTOMER_SELLER_ID) AS CUSTOMER_SELLER_ID
  , COALESCE(A.CUSTOMER_SELLER_NAME,B.CUSTOMER_SELLER_NAME) AS CUSTOMER_SELLER_NAME
  , COALESCE(A.ITEM_ID,B.ITEM_ID) AS ITEM_ID
  , COALESCE(A.ITEM_TITLE_NAME,B.ITEM_TITLE_NAME) AS ITEM_TITLE_NAME
  , COALESCE(A.TIER,B.TIER) AS TIER
  , COALESCE(A.ITEM_STATE,B.ITEM_STATE) AS ITEM_STATE
  , COALESCE(A.ITEM_CITY,B.ITEM_CITY) AS ITEM_CITY
  , COALESCE(A.ITEM_NEIGHBORHOOD,B.ITEM_NEIGHBORHOOD) AS ITEM_NEIGHBORHOOD
  , COALESCE(A.ITEM_LATITUD,B.ITEM_LATITUD) AS ITEM_LATITUD
  , COALESCE(A.ITEM_LONGITUD,B.ITEM_LONGITUD) AS ITEM_LONGITUD
  , COALESCE(A.HAS_VIDEO,B.HAS_VIDEO) AS HAS_VIDEO
  , COALESCE(A.CATEGORY_NAME_L1,B.CATEGORY_NAME_L1) AS CATEGORY_NAME_L1
  , COALESCE(A.CATEGORY_NAME_L2,B.CATEGORY_NAME_L2) AS CATEGORY_NAME_L2
  , COALESCE(A.CATEGORY_NAME_L3,B.CATEGORY_NAME_L3) AS CATEGORY_NAME_L3
  , COALESCE(A.CATEGORY_NAME_L4,B.CATEGORY_NAME_L4) AS CATEGORY_NAME_L4
  , COALESCE(A.CATEGORY_NAME_L5,B.CATEGORY_NAME_L5) AS CATEGORY_NAME_L5
  , COALESCE(A.CATEGORY_NAME_L6,B.CATEGORY_NAME_L6) AS CATEGORY_NAME_L6
  , COALESCE(A.CATEGORY_NAME_L7,B.CATEGORY_NAME_L7) AS CATEGORY_NAME_L7
  , COALESCE(A.COMBO,B.COMBO) AS COMBO
  , COALESCE(A.ITEM_PARENT_ID,B.ITEM_PARENT_ID) AS ITEM_PARENT_ID
  , COALESCE(A.ITEM_DOMAIN,B.ITEM_DOMAIN) AS ITEM_DOMAIN
  , COALESCE(A.ITEM_CONDITION,B.ITEM_CONDITION) AS ITEM_CONDITION
  , COALESCE(A.ITEM_LISTING_TYPE,B.ITEM_LISTING_TYPE) AS ITEM_LISTING_TYPE
  , COALESCE(A.OPERATION,B.OPERATION) AS OPERATION
  , COALESCE(A.PROPERTY_TYPE,B.PROPERTY_TYPE) AS PROPERTY_TYPE
  , COALESCE(A.MEASURE_TYPE_TOTAL_AREA,B.MEASURE_TYPE_TOTAL_AREA) AS MEASURE_TYPE_TOTAL_AREA
  , COALESCE(A.TOTAL_AREA,B.TOTAL_AREA) AS TOTAL_AREA
  , COALESCE(A.MEASURE_TYPE_COVERED_AREA,B.MEASURE_TYPE_COVERED_AREA) AS MEASURE_TYPE_COVERED_AREA
  , COALESCE(A.COVERED_AREA,B.COVERED_AREA) AS COVERED_AREA
  , COALESCE(A.MEASURE_TYPE_BALCONY_AREA,B.MEASURE_TYPE_BALCONY_AREA) AS MEASURE_TYPE_BALCONY_AREA
  , COALESCE(A.BALCONY_AREA,B.BALCONY_AREA) AS BALCONY_AREA
  , COALESCE(A.PROPERTY_AGE,B.PROPERTY_AGE) AS PROPERTY_AGE
  , COALESCE(A.BEDROOMS,B.BEDROOMS) AS BEDROOMS
  , COALESCE(A.FULL_BATHROOMS,B.FULL_BATHROOMS) AS FULL_BATHROOMS
  , COALESCE(A.ROOMS,B.ROOMS) AS ROOMS
  , COALESCE(A.SIT_CURRENCY_MAINTENANCE_FEE,B.SIT_CURRENCY_MAINTENANCE_FEE) AS SIT_CURRENCY_MAINTENANCE_FEE
  , COALESCE(A.MAINTENANCE_FEE,B.MAINTENANCE_FEE) AS MAINTENANCE_FEE
  , COALESCE(A.APARTMENT_PROPERTY_SUBTYPE,B.APARTMENT_PROPERTY_SUBTYPE) AS APARTMENT_PROPERTY_SUBTYPE
  , COALESCE(A.PARKING_LOTS,B.PARKING_LOTS) AS PARKING_LOTS

  , COALESCE(A.CMG_SITE,B.CMG_SITE) AS CMG_SITE


  , COALESCE(A.FURNISHED,B.FURNISHED) AS FURNISHED
  , COALESCE(A.HAS_BUSINESS_CENTER,B.HAS_BUSINESS_CENTER) AS HAS_BUSINESS_CENTER
  , COALESCE(A.HAS_GYM,B.HAS_GYM) AS HAS_GYM
  , COALESCE(A.HAS_LAUNDRY,B.HAS_LAUNDRY) AS HAS_LAUNDRY
  , COALESCE(A.HAS_COMMON_LAUNDRY,B.HAS_COMMON_LAUNDRY) AS HAS_COMMON_LAUNDRY
  , COALESCE(A.HAS_HEATING,B.HAS_HEATING) AS HAS_HEATING
  , COALESCE(A.HAS_MULTIPURPOSE_ROOM,B.HAS_MULTIPURPOSE_ROOM) AS HAS_MULTIPURPOSE_ROOM
  , COALESCE(A.HAS_TENNIS_COURT,B.HAS_TENNIS_COURT) AS HAS_TENNIS_COURT
  , COALESCE(A.HAS_AIR_CONDITIONING,B.HAS_AIR_CONDITIONING) AS HAS_AIR_CONDITIONING
  , COALESCE(A.HAS_FRONT_DESK,B.HAS_FRONT_DESK) AS HAS_FRONT_DESK
  , COALESCE(A.HAS_GUEST_PARKING,B.HAS_GUEST_PARKING) AS HAS_GUEST_PARKING
  , COALESCE(A.HAS_JACUZZI,B.HAS_JACUZZI) AS HAS_JACUZZI
  , COALESCE(A.HAS_PLAYGROUND,B.HAS_PLAYGROUND) AS HAS_PLAYGROUND
  , COALESCE(A.HAS_INDOOR_FIREPLACE,B.HAS_INDOOR_FIREPLACE) AS HAS_INDOOR_FIREPLACE
  , COALESCE(A.HAS_PARTY_ROOM,B.HAS_PARTY_ROOM) AS HAS_PARTY_ROOM
  , COALESCE(A.HAS_SECURITY,B.HAS_SECURITY) AS HAS_SECURITY
  , COALESCE(A.HAS_SWIMMING_POOL,B.HAS_SWIMMING_POOL) AS HAS_SWIMMING_POOL
  , COALESCE(A.HAS_BARBECUE_AREA,B.HAS_BARBECUE_AREA) AS HAS_BARBECUE_AREA
  , COALESCE(A.HAS_GRILL,B.HAS_GRILL) AS HAS_GRILL
  , COALESCE(A.WITH_VIRTUAL_TOUR,B.WITH_VIRTUAL_TOUR) AS WITH_VIRTUAL_TOUR
  , COALESCE(A.HAS_BALCONY,B.HAS_BALCONY) AS HAS_BALCONY
  , COALESCE(A.HAS_GARDEN,B.HAS_GARDEN) AS HAS_GARDEN
  , COALESCE(A.HAS_TERRACE,B.HAS_TERRACE) AS HAS_TERRACE
  , COALESCE(A.IS_SUITABLE_FOR_PETS,B.IS_SUITABLE_FOR_PETS) AS IS_SUITABLE_FOR_PETS
  , COALESCE(A.PETS_ALLOWED,B.PETS_ALLOWED) AS PETS_ALLOWED
  , COALESCE(A.HAS_INTERNET_ACCESS,B.HAS_INTERNET_ACCESS) AS HAS_INTERNET_ACCESS
  , COALESCE(A.ES_FINANCIABLE,B.ES_FINANCIABLE) AS ES_FINANCIABLE
  , MAX_DATE_IN_THE_MONTH -- VA SERVIR PARA CALCULAR LIVE LISTINGS POR PERIODOS MÁS GRANDES (Q, ANUAL)
  , COALESCE(A.SITE_CURRENCY_ID,B.SITE_CURRENCY_ID) AS SITE_CURRENCY_ID
  , COALESCE(A.SITE_CURRENCY_ITEM_PRICE,B.SITE_CURRENCY_ITEM_PRICE) AS SITE_CURRENCY_ITEM_PRICE
  , COALESCE(A.ITEM_LOCAL_PRICE,B.ITEM_LOCAL_PRICE) AS ITEM_LOCAL_PRICE
  , COALESCE(A.ITEM_USD_PRICE,B.ITEM_USD_PRICE) AS ITEM_USD_PRICE

  -- COMIENZO DE METRICAS 
  , SUM(ML_CONTACTOS_TOTALES_UNIQUE) AS ML_CONTACTOS_TOTALES_UNIQUE
  , SUM(NO_ML_CONTACTOS_TOTALES_UNIQUE) AS NO_MLCONTACTOS_TOTALES_UNIQUE
  , SUM(CONTACTOS_TOTALES_UNIQUE) AS CONTACTOS_TOTALES_UNIQUE
  , SUM(ML_CALL) AS ML_CALL
  , SUM(NO_ML_CALL) AS NO_MLCALL
  , SUM(CALL) AS CALL
  , SUM(ML_WHATSAPP) AS ML_WHATSAPP
  , SUM(NO_ML_WHATSAPP) AS NO_MLWHATSAPP
  , SUM(WHATSAPP) AS WHATSAPP
  , SUM(ML_PREGUNTAS_UNICOS) AS ML_PREGUNTAS_UNICOS
  , SUM(NO_ML_PREGUNTAS_UNICOS) AS NO_MLPREGUNTAS_UNICOS
  , SUM(PREGUNTAS_UNICOS) AS PREGUNTAS_UNICOS
  , SUM(ML_QUOTATIONS_UNICOS) AS ML_QUOTATIONS_UNICOS
  , SUM(NO_ML_QUOTATIONS_UNICOS) AS NO_MLQUOTATIONS_UNICOS
  , SUM(QUOTATIONS_UNICOS) AS QUOTATIONS_UNICOS
  , SUM(VIEW_PHONE) AS VIEW_PHONE
  , SUM(VISITAS_IOS) AS VISITAS_IOS
  , SUM(VISITAS_ANDROID) AS VISITAS_ANDROID
  , SUM(VISITAS_MOBILEWEB) AS VISITAS_MOBILEWEB
  , SUM(VISITAS_STD_DESKTOP) AS VISITAS_STD_DESKTOP
  , SUM(VISITAS_OTROS) AS VISITAS_OTROS
  , SUM(VISITAS_TOTAL) AS VISITAS_TOTAL
  , SUM(ITEMS_MENSUAL) AS ITEMS_MENSUAL -- VA SERVIR PARA CALCULAR LIVE LISTINGS POR PERIODOS MÁS GRANDES (Q, ANUAL)
  , SUM(LIVE_LISTINGS) AS LIVE_LISTINGS

FROM `meli-bi-data.SBOX_MKTVIS.DASH_REAL_ESTATE_LIVE_LISTINGS_MONTHLY` AS A

FULL OUTER JOIN `meli-bi-data.SBOX_MKTVIS.DASH_REAL_ESTATE_LEADS_VISITS_MONTHLY` AS B
ON A.YEAR_MONTH = B.YEAR_MONTH
AND A.SITE_ID = B.SITE_ID
AND A.ITEM_ID = B.ITEM_ID

GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75
;
